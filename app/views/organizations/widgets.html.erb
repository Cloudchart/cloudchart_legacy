<%
  collections = {
    charts: @organization.charts.map { |x| [x.id, x.title] },
    persons: @organization.identities.map { |x| [x.entity_id, x.title] }
  }
%>
<div class="organization container" data-behavior="organization-widgets" data-collections="<%= collections.to_json %>">
  <div class="row">
    <div class="span3">
      <%= render partial: "/organizations/sidebar" %>
    </div>
    <div class="span7 constructor">
      <% @organization.widgets_enum.each do |area| %>
      <div class="area <%= area %>">
        <span><%= area.humanize %></span>
        <div class="contents" data-area="<%= area %>" data-behavior="sortable">
          <% if @organization.widgets && @organization.widgets[area] %>
            <% @organization.widgets[area].each do |widget| %>
              <%= content_tag(:div, data: { behavior: "render", keys: Widget.type_keys[widget["type"].to_sym], json: widget } ) {} %>
            <% end %>
          <% end %>
        </div>
      </div>
      <% end %>
      <button class="btn btn-primary" data-behavior="save" data-action="<%= organization_path(@organization) %>"><%= t("organizations.widgets.save") %></button>
    </div>
    <div class="span2 widgets">
      <% Widget.type_enum.each do |type| %>
      <div class="widget <%= type %>" data-type="<%= type %>" data-keys="<%= Widget.type_keys[type.to_sym].to_json %>" data-behavior="draggable"><%= type.humanize %></div>
      <% end %>
    </div>
  </div>
</div>
