<%
  person ||= Person.new
  title ||= ""
  profile = person.name.present?
  chart ||= nil
%>
<div class="overlay persons">
  <div class="box">
    <div class="content">
      <%= simple_form_for(person, html: { class: "form-horizontal" }, url: chart_persons_path(chart_id: @chart.id) ) do |f| %>
        <div class="control-group">
          <div class="control-label">
            <%= image_tag "ico-person.png", class: "person", data: { icon: image_path("ico-person.png") } %>
          </div>
          <div class="controls">
            <div class="input">
              <%= f.text_field :q, label: false, data: { value: person.name } %>
            </div>
            <%= f.submit value: "" %>
          </div>
        </div>
        <div class="control-group">
          <div class="control-label">
            <%= image_tag "ico-best-guess.png", class: "best-guess" %>
          </div>
          <div class="controls">
            <% if user_signed_in? %>
            <ul class="list"<%= raw ' style="display: none"' if profile %>></ul>
            <div class="profile"<%= raw ' style="display: block"' if profile %>>
              <%=
                render partial: "/persons/profile", locals: {
                  title: title,
                  chart: chart,
                  note: note,
                  person: person
                } if profile && chart
              %>
            </div>
            <% else %>
            <h3><%= t("common.please_sign_in") %></h3>
            <% end %>
            <%= render partial: "/shared/loading" %>
          </div>
        </div>
      <% end %>
    </div>

    <div class="buttons for-list"<%= raw ' style="display: none"' if profile %>>
      <button class="fire"><%= t("charts.persons.okay") %></button>
    </div>
    <div class="buttons for-profile"<%= raw ' style="display: block"' if profile %>>
      <button class="fire"><%= t("charts.persons.add") %></button>
    </div>
  </div>
</div>
