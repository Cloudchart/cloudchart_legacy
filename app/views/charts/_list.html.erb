<%
  charts = charts.to_a
  charts.delete_if { |x| x.new_record? }
  charts.push(Chart.new) if charts.length < 6
  (6 - charts.length).times {
    charts.push(nil)
  } if charts.length < 5
%>
<% charts.each_slice(3) do |sliced| %>
<div class="charts row-fluid">
  <% sliced.each do |chart| %>
    <%
      if !chart
        link = ""
        cls = ""
      elsif can?(:edit, chart)
        link = edit_chart_path(chart.slug_or_id)
        cls = ""
      elsif chart.demo?
        link = clone_chart_path(chart.slug_or_id)
        cls = "clone"
      elsif
        link = chart_path(chart.slug_or_id)
        cls = ""
      end
    %>
    <div class="item span4">
      <% if !chart %>
      <div class="inner placeholder"></div>
      <% elsif chart.new_record? %>
      <div class="inner create" data-href="<%= charts_path %>">
      </div>
      <% else %>
      <div class="inner">
        <h1><%= link_to chart.title, link, class: cls %></h1>
        <div class="img">
          <%= link_to image_tag(chart.to_png(:preview), alt: chart.title, title: chart.title), link, class: cls %>
        </div>
        <p>
          <span><%= t("charts.last_saved", time: pretty_time(chart.updated_at)).downcase %></span>
          <%= link_to image_tag("btn-small-arrow.png"), "#" %>
        </p>
      </div>
      <% end %>
    </div>
  <% end %>
</div>
<% end %>
<ins data-init="chart"></ins>